<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="/main.css">
    <script src="//unpkg.com/alpinejs" defer></script>
    <script src="/main.js" defer></script>
    <script>
        console.log("404site.html, window.location:", window.location);

        let token;
        async function initAlpine() {
            console.log("initAlpine");
            let uri = window.location;
            token = uri.pathname.substr(3, 6);
            let apiURL = `/api/site-files.json?token=${token}`;
            Alpine.store('data', {
                "files": [],
                "token": token,
                async init() {
                    console.log("starting fetch:", apiURL);
                    let rsp = await fetch(apiURL);
                    let js = await rsp.json();
                    // console.log("js:", JSON.stringify(js, null, "  "))
                    function cmpByName(f1, f2) {
                        let n1 = f1.Path.toLowerCase();
                        let n2 = f2.Path.toLowerCase();
                        if (n1 < n2) {
                            return -1;
                        }
                        if (n1 > n2) {
                            return 1;
                        }
                        return 0;
                    }
                    js.sort(cmpByName);
                    this.files = js;
                }
            });
        }

        function fileLink(file) {
            let baseURL = `/p/${token}/`;
            let fullURL = baseURL + file.Path;
            let html = `<a href="${fullURL}">${file.Path}</a>`;
            return html;
        }

        function init() {
            console.log("init");
            let path = window.location.pathname;
            const el = document.getElementById("fileId");
            el.textContent = path;
        }

        window.addEventListener("DOMContentLoaded", init);
        document.addEventListener('alpine:init', initAlpine);
    </script>
</head>

<body>
    <div id="body-wrapper">
        <p>
            <a href="/">Home</a> / File <span id="fileId"></span> not found on this site. Here's a list of files that do exist:
        </p>
        <div x-data>
            <table class="tblList">
                <template x-for="file in $store.data.files">
                    <tr>
                        <td x-html="fileLink(file)">
                        </td>
                        <td x-text="humanizeSize(file.Size)"></td>
                    </tr>
                </template>
            </table>
        </div>
    </div>
</body>

</html>